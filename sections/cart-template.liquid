{%- if cart != empty -%}
  <div class="cart" data-cart>
    <h1>ショッピングカート</h1>
    
    <form action="{{ routes.cart_url }}" method="post" novalidate>
      <table class="cart-items">
        <thead>
          <tr>
            <th>商品</th>
            <th>価格</th>
            <th>数量</th>
            <th>小計</th>
          </tr>
        </thead>
        <tbody>
          {%- for item in cart.items -%}
            <tr class="cart-item" data-cart-item="{{ item.key }}">
              <td>
                <img src="{{ item | img_url: '100x' }}" alt="{{ item.title | escape }}">
                <div>
                  <a href="{{ item.url }}">{{ item.product.title }}</a>
                  {%- if item.product.has_only_default_variant == false -%}
                    <p>{{ item.variant.title }}</p>
                  {%- endif -%}
                </div>
              </td>
              <td>{{ item.price | money }}</td>
              <td>
                <quantity-input>
                  <button type="button" name="minus" class="quantity__button">-</button>
                  <input type="number" 
                         name="updates[]" 
                         value="{{ item.quantity }}" 
                         min="0"
                         data-index="{{ forloop.index }}"
                  >
                  <button type="button" name="plus" class="quantity__button">+</button>
                </quantity-input>
                <button type="button" 
                        class="remove-button"
                        onclick="this.closest('tr').remove(); updateCart()">
                  削除
                </button>
              </td>
              <td>{{ item.final_line_price | money }}</td>
            </tr>
          {%- endfor -%}
        </tbody>
      </table>
  
      <div class="cart-footer">
        <div class="cart-total">
          <span>合計: </span>
          <strong>{{ cart.total_price | money }}</strong>
        </div>
        
        <div class="cart-actions">
          <button type="submit" name="update" class="update-cart">カートを更新</button>
          <button type="submit" name="checkout" class="checkout-button">購入手続きへ</button>
        </div>
      </div>
    </form>
  </div>
  
  {%- else -%}
  <div class="empty-cart">
    <p>カートに商品がありません</p>
    <a href="/" class="continue-shopping">買い物を続ける</a>
  </div>
  {%- endif -%}
  
  <script>
  function updateCart() {
    const cartForm = document.querySelector('[data-cart]');
    const formData = new FormData(cartForm);
    
    fetch('{{ routes.cart_update_url }}', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      // カート内容を更新
      window.location.reload();
    })
    .catch(error => console.error('Error:', error));
  }
  
  document.querySelectorAll('quantity-input').forEach(container => {
    const input = container.querySelector('input');
    const minusButton = container.querySelector('[name="minus"]');
    const plusButton = container.querySelector('[name="plus"]');
  
    minusButton.addEventListener('click', () => {
      const currentValue = parseInt(input.value);
      if (currentValue > 0) {
        input.value = currentValue - 1;
        updateCart();
      }
    });
  
    plusButton.addEventListener('click', () => {
      input.value = parseInt(input.value) + 1;
      updateCart();
    });
  });
  </script>
  
  {% style %}
  .cart {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .cart-items {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
  }
  
  .cart-items th,
  .cart-items td {
    padding: 1rem;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }
  
  .cart-item img {
    max-width: 100px;
    height: auto;
  }
  
  quantity-input {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .quantity__button {
    padding: 0.5rem;
    border: 1px solid #ddd;
    background: #f5f5f5;
    cursor: pointer;
  }
  
  .quantity__button:hover {
    background: #e5e5e5;
  }
  
  input[type="number"] {
    width: 60px;
    padding: 0.5rem;
    text-align: center;
  }
  
  .remove-button {
    margin-top: 0.5rem;
    padding: 0.25rem 0.5rem;
    color: #666;
    background: none;
    border: none;
    cursor: pointer;
  }
  
  .remove-button:hover {
    color: #ff0000;
  }
  
  .cart-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
  }
  
  .cart-total {
    font-size: 1.2rem;
  }
  
  .cart-actions {
    display: flex;
    gap: 1rem;
  }
  
  .update-cart,
  .checkout-button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  
  .update-cart {
    background: #f5f5f5;
  }
  
  .checkout-button {
    background: #000;
    color: #fff;
  }
  
  .empty-cart {
    text-align: center;
    padding: 4rem 2rem;
  }
  
  .continue-shopping {
    display: inline-block;
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    background: #000;
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
  }
  {% endstyle %}