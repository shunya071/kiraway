{% comment %}sections/main-product.liquid{% endcomment %}

<script src="{{ 'product-gallery.js' | asset_url }}" defer="defer"></script>

<div class="product-container max-w-7xl mx-auto px-4">
  {%- assign current_variant = product.selected_or_first_available_variant -%}
  
  <!-- 商品画像とバリアントセレクター部分 -->
  <div class="product-header grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
    <div class="product-gallery">
      {% for image in product.images %}
        <div class="product-image {% unless forloop.first %}hidden{% endunless %}" data-image-id="{{ image.id }}">
          <img src="{{ image | img_url: 'large' }}" alt="{{ image.alt | escape }}" class="w-full">
        </div>
      {% endfor %}
      {% if product.images.size > 1 %}
        <div class="product-thumbnails flex gap-2 mt-4">
          {% for image in product.images %}
            <button class="thumbnail-btn w-20 h-20" data-thumbnail-id="{{ image.id }}">
              <img src="{{ image | img_url: 'small' }}" alt="{{ image.alt | escape }}" class="w-full h-full object-cover">
            </button>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="product-info">
      <h1 class="text-3xl font-bold mb-4">{{ product.title }}</h1>
      <div class="price-container mb-6">
        <span class="text-2xl font-semibold">{{ current_variant.price | money }}</span>
        {% if current_variant.compare_at_price > current_variant.price %}
          <span class="text-gray-500 line-through ml-2">{{ current_variant.compare_at_price | money }}</span>
        {% endif %}
      </div>

      {% form 'product', product %}
        <input type="hidden" name="id" value="{{ current_variant.id }}">
        
        {% for option in product.options_with_values %}
          <div class="variant-selector mb-4">
            <label class="block text-sm font-medium mb-2">{{ option.name }}</label>
            <select name="options[{{ option.name }}]" class="w-full border rounded p-2">
              {% for value in option.values %}
                <option value="{{ value }}" {% if option.selected_value == value %}selected{% endif %}>
                  {{ value }}
                </option>
              {% endfor %}
            </select>
          </div>
        {% endfor %}

        <button type="submit" class="add-to-cart w-full bg-{{ settings.accent_color }} text-white py-3 rounded hover:opacity-90">
          {% if current_variant.available %}
            {{ 'products.product.add_to_cart' | t }}
          {% else %}
            {{ 'products.product.sold_out' | t }}
          {% endif %}
        </button>
      {% endform %}
    </div>
  </div>

  <!-- 商品詳細情報 -->
  <div class="product-details mb-12">
    <div class="bg-{{ settings.secondary_bg_color }} p-6 rounded">
      <h2 class="text-2xl font-bold mb-4">{{ 'products.product.details' | t }}</h2>
      <div class="product-description prose">
        {{ product.description }}
      </div>
    </div>
  </div>

  <!-- レビューセクション -->
  <div class="reviews-section mb-12">
    <h2 class="text-2xl font-bold mb-4">{{ 'products.product.reviews' | t }}</h2>
    {% render 'product-reviews' %}
  </div>

  <!-- おすすめ商品 -->
  <div class="recommended-products">
    <h2 class="text-2xl font-bold mb-4">{{ 'products.product.recommendations' | t }}</h2>
    {% render 'product-recommendations', product: product %}
  </div>
</div>

<style>
.product-container {
  margin-top: 2rem;
}

.variant-selector select {
  background-color: white;
}

.product-description {
  line-height: 1.6;
}
</style>

{% schema %}
{
  "name": "Product Template",
  "settings": [
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#00A86B"
    },
    {
      "type": "color",
      "id": "secondary_bg_color",
      "label": "Secondary Background Color",
      "default": "#F5F5F5"
    }
  ]
}
{% endschema %}